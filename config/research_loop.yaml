# =============================================================================
# ARGUS - Strategy Research Loop Configuration
# =============================================================================
# This config drives the strategy_research_loop.py script.
# Copy to research_loop.yaml and customize for your environment.
#
# Usage:
#   python scripts/strategy_research_loop.py --config config/research_loop.yaml --once
# =============================================================================

# ── Pack specification ─────────────────────────────────────────────────────
# How to build replay packs for this cycle.
pack:
  # One of: "single" (use symbols list) or "universe" (liquid ETF universe).
  mode: "single"
  # For mode=single: list of symbols to pack.
  symbols: ["SPY", "QQQ", "IBIT", "IWM"]
  # Date range: either fixed or "last_n_days" (computed at run time).
  # Option A: fixed range
  start_date: "2026-02-01"
  end_date: "2026-02-11"
  # Option B: use last_n_days (optional; overrides start/end if set)
  last_n_days: 7
  # Bars provider override (null = use data_sources.bars_primary from config).
  bars_provider: null
  # Options snapshot provider override (null = use config default).
  options_snapshot_provider: null
  # Output directory for built packs.
  packs_output_dir: "data/packs"
  # DB path for replay_pack and outcomes.
  db_path: "data/argus.db"

# ── Outcomes ───────────────────────────────────────────────────────────────
# Ensure outcomes exist before building packs.
outcomes:
  # If true, run outcomes backfill for pack date range before building packs.
  ensure_before_pack: true
  # Bar duration in seconds (must match bars in DB).
  bar_duration: 60

# ── Strategies and experiments ──────────────────────────────────────────────
# strategy_class: Class name (string). Loaded from src.strategies.vrp_credit_spread
#   and src.strategies.dow_regime_timing. Supported: VRPCreditSpreadStrategy,
#   DowRegimeTimingGateStrategy (and any other ReplayStrategy in those modules).
# params: Dict passed as the strategy constructor's first argument. Merged with
#   sweep rows when sweep is set. For VRPCreditSpreadStrategy this is the
#   "thresholds" dict: min_vrp (float), max_vol_regime, avoid_trend. Use {} for defaults.
# sweep: Path to YAML param grid (relative to project root), or null for single run.
#   Grid format: each key = param name, value = list of values; all combinations
#   are run. Example: config/vrp_sweep.yaml with content:
#     min_vrp: [0.02, 0.05, 0.08]
#     max_vol_regime: ["VOL_LOW", "VOL_NORMAL"]
strategies:
  - strategy_class: "VRPCreditSpreadStrategy"
    params: {}   # or e.g. { min_vrp: 0.03, max_vol_regime: "VOL_NORMAL" }
    sweep: "config/vrp_sweep.yaml"
  # - strategy_class: "VRPCreditSpreadStrategy"
  #   params: { min_vrp: 0.03 }
  #   sweep: "config/vrp_sweep.yaml"

# ── Experiment runner options ───────────────────────────────────────────────
experiment:
  output_dir: "logs/experiments"
  starting_cash: 10000.0
  regime_stress: true
  mc_bootstrap: true
  mc_paths: 1000
  mc_method: "bootstrap"
  mc_block_size: null
  mc_seed: 42
  mc_ruin_level: 0.2
  mc_kill_thresholds: null

# ── Evaluation ──────────────────────────────────────────────────────────────
evaluation:
  # Where evaluator reads experiment outputs from.
  input_dir: null   # null => use experiment.output_dir
  kill_thresholds: null   # path to YAML or null for defaults
  rankings_output_dir: "logs"
  killed_output_path: null
  candidate_set_output_path: null
  # Allocation step (Phase 5 prelude): run allocation after evaluation.
  # Set allocations_output_path to enable; null = skip allocation step.
  allocation:
    kelly_fraction: 0.30
    per_play_cap: 0.07
    vol_target_annual: 0.10
    # Optional options-risk sizing override; either a single float or per-strategy map.
    # max_loss_per_contract: 300.0
    # max_loss_per_contract:
    #   VRP_v1: 300.0
    #   VRP_v2: 450.0
  allocations_output_path: "logs/allocations.json"   # e.g. "logs/allocations.json"
  equity: 5000.0
  min_dsr: 0.0
  min_composite_score: 0.0

# ── Loop (daemon) ───────────────────────────────────────────────────────────
# Only used when running without --once.
loop:
  interval_hours: 24
  require_recent_bars_hours: null
